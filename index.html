<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Multi-Agent Tutoring System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        math: '#3b82f6',
                        physics: '#8b5cf6',
                        tutor: '#10b981',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --math-color: #3b82f6;
            --physics-color: #8b5cf6;
            --tutor-color: #10b981;
        }
        .message-container {
            display: flex;
            flex-direction: column;
            max-height: 65vh;
            overflow-y: auto;
        }
        .user-message {
            align-self: flex-end;
            background-color: #dbeafe;
            border-radius: 1rem 1rem 0 1rem;
            max-width: 80%;
        }
        .agent-message {
            align-self: flex-start;
            background-color: #f3f4f6;
            border-radius: 1rem 1rem 1rem 0;
            max-width: 80%;
        }
        .math-agent {
            border-left: 4px solid var(--math-color);
        }
        .physics-agent {
            border-left: 4px solid var(--physics-color);
        }
        .tutor-agent {
            border-left: 4px solid var(--tutor-color);
        }
        .tool-indicator {
            font-size: 0.75rem;
            background-color: #e5e7eb;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            display: inline-block;
        }
        .typing-indicator {
            display: inline-flex;
            align-items: center;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #6b7280;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        .subject-tag {
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .math-tag {
            background-color: #dbeafe;
            color: var(--math-color);
        }
        .physics-tag {
            background-color: #ede9fe;
            color: var(--physics-color);
        }
        .tutor-tag {
            background-color: #d1fae5;
            color: var(--tutor-color);
        }
        .system-diagram {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .system-diagram {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .agent-card {
            border-radius: 0.75rem;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .agent-card:hover {
            transform: translateY(-5px);
        }
        .math-card {
            border-top: 4px solid var(--math-color);
        }
        .physics-card {
            border-top: 4px solid var(--physics-color);
        }
        .tutor-card {
            border-top: 4px solid var(--tutor-color);
        }
        .math-step {
            background-color: #e0f2fe;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 3px solid var(--math-color);
        }
        .equation {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            padding: 0.25rem 0.5rem;
            background-color: #f1f5f9;
            border-radius: 0.25rem;
            display: inline-block;
        }
        .operation {
            color: #dc2626;
            font-weight: bold;
            margin: 0 0.5rem;
        }
        .solution {
            background-color: #d1fae5;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border-left: 3px solid var(--tutor-color);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-robot text-indigo-600 text-2xl"></i>
                        <span class="ml-2 text-xl font-bold text-gray-900">TutorBot Pro</span>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#chat" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-indigo-600">Chat</a>
                    <a href="#agents" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-indigo-600">Agents</a>
                    <a href="#documentation" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-indigo-600">Documentation</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl lg:text-6xl">
                    Advanced Multi-Agent Tutoring
                </h1>
                <p class="mt-6 max-w-lg mx-auto text-xl text-indigo-100">
                    Intelligent tutoring with step-by-step equation solving and physics explanations
                </p>
                <div class="mt-10 flex justify-center">
                    <a href="#chat" class="flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-indigo-50">
                        Try it now
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chat" class="py-12 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Interactive Tutor</h2>
                <p class="mt-4 text-lg text-gray-500">
                    Ask questions about math or physics. Our tutor agent will route your query to the appropriate specialist.
                </p>
            </div>

            <div class="mt-8 bg-gray-50 rounded-xl shadow-md overflow-hidden">
                <div class="p-4 bg-gray-800 text-white">
                    <div class="flex items-center">
                        <div class="h-3 w-3 rounded-full bg-green-400 mr-2"></div>
                        <span class="text-sm font-medium">Tutor Agent is online</span>
                    </div>
                </div>
                
                <div class="p-4">
                    <div id="chat-messages" class="message-container space-y-4 mb-4 p-4 bg-white rounded-lg h-[400px] overflow-y-auto">
                        <!-- Initial welcome message -->
                        <div class="agent-message p-4 tutor-agent">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-2">
                                    <i class="fas fa-robot text-green-500"></i>
                                </div>
                                <span class="font-medium">Tutor Agent</span>
                                <span class="tutor-tag subject-tag ml-2">Tutor</span>
                            </div>
                            <p>Hello! I'm your AI tutor assistant. I can help with math and physics questions. What would you like to learn today?</p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <input 
                            type="text" 
                            id="user-input" 
                            placeholder="Ask a math or physics question..." 
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        >
                        <button 
                            id="send-btn" 
                            class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-r-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                        >
                            Send
                        </button>
                    </div>
                    
                    <div class="mt-4 flex flex-wrap gap-2">
                        <button class="example-btn px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200" data-query="Solve 3x - 7 = 14">
                            Solve 3x - 7 = 14
                        </button>
                        <button class="example-btn px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200" data-query="Explain quantum entanglement">
                            Explain quantum entanglement
                        </button>
                        <button class="example-btn px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200" data-query="Solve 2(x + 3) = 10">
                            Solve 2(x + 3) = 10
                        </button>
                        <button class="example-btn px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200" data-query="Calculate the area of a circle with radius 5">
                            Calculate area of circle (r=5)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Architecture Section -->
    <div id="agents" class="py-12 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Multi-Agent Architecture</h2>
                <p class="mt-4 text-lg text-gray-500">
                    Our system follows Google's ADK principles with specialized agents and tools
                </p>
            </div>
            
            <div class="mt-10 system-diagram">
                <!-- Tutor Agent -->
                <div class="agent-card tutor-card bg-white shadow-lg">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mr-3">
                                <i class="fas fa-robot text-green-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Tutor Agent</h3>
                                <p class="text-sm text-gray-500">Primary interface & router</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">
                            Receives user queries, classifies the subject, and delegates to specialist agents.
                        </p>
                        <div class="flex flex-wrap gap-2">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">
                                Gemini API
                            </span>
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">
                                Intent Recognition
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Math Agent -->
                <div class="agent-card math-card bg-white shadow-lg">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                <i class="fas fa-calculator text-blue-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Math Agent</h3>
                                <p class="text-sm text-gray-500">Mathematics specialist</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">
                            Handles algebra, calculus, geometry, and other math-related questions.
                        </p>
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-900 mb-2">Tools:</h4>
                            <div class="flex items-center mb-2">
                                <div class="w-6 h-6 rounded bg-blue-100 flex items-center justify-center mr-2">
                                    <i class="fas fa-calculator text-blue-500 text-xs"></i>
                                </div>
                                <span>Equation Solver</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-6 h-6 rounded bg-blue-100 flex items-center justify-center mr-2">
                                    <i class="fas fa-square-root-alt text-blue-500 text-xs"></i>
                                </div>
                                <span>Algebra Engine</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Physics Agent -->
                <div class="agent-card physics-card bg-white shadow-lg">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mr-3">
                                <i class="fas fa-atom text-purple-500 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Physics Agent</h3>
                                <p class="text-sm text-gray-500">Physics specialist</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">
                            Handles mechanics, thermodynamics, electromagnetism, and other physics topics.
                        </p>
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-900 mb-2">Tools:</h4>
                            <div class="flex items-center mb-2">
                                <div class="w-6 h-6 rounded bg-purple-100 flex items-center justify-center mr-2">
                                    <i class="fas fa-book text-purple-500 text-xs"></i>
                                </div>
                                <span>Constants Lookup</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-6 h-6 rounded bg-purple-100 flex items-center justify-center mr-2">
                                    <i class="fas fa-ruler-combined text-purple-500 text-xs"></i>
                                </div>
                                <span>Unit Converter</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-12 bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Equation Solving Process</h3>
                    <div class="flex flex-col items-center">
                        <div class="w-full max-w-2xl">
                            <div class="bg-blue-50 p-5 rounded-lg">
                                <div class="grid grid-cols-5 gap-2 items-center mb-4">
                                    <div class="text-center">
                                        <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center mx-auto mb-2">
                                            <i class="fas fa-search text-blue-700"></i>
                                        </div>
                                        <span class="text-xs font-medium">Parse</span>
                                    </div>
                                    <div class="text-center">
                                        <i class="fas fa-arrow-right text-gray-400"></i>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center mx-auto mb-2">
                                            <i class="fas fa-arrows-alt-h text-blue-700"></i>
                                        </div>
                                        <span class="text-xs font-medium">Balance</span>
                                    </div>
                                    <div class="text-center">
                                        <i class="fas fa-arrow-right text-gray-400"></i>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center mx-auto mb-2">
                                            <i class="fas fa-calculator text-blue-700"></i>
                                        </div>
                                        <span class="text-xs font-medium">Solve</span>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-700">
                                    <p class="mb-2">The Math Agent uses a sophisticated equation solver that:</p>
                                    <ul class="list-disc pl-5 space-y-1">
                                        <li>Parses equations into mathematical expressions</li>
                                        <li>Applies inverse operations to isolate the variable</li>
                                        <li>Performs step-by-step algebraic manipulation</li>
                                        <li>Verifies solutions by plugging back into the original equation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Documentation Section -->
    <div id="documentation" class="py-12 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Project Documentation</h2>
                <p class="mt-4 text-lg text-gray-500">
                    Implementation details and deployment information
                </p>
            </div>
            
            <div class="mt-8 bg-gray-50 rounded-xl shadow-md overflow-hidden">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Technical Implementation</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">Equation Solving Algorithm</h4>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-gray-700">The Math Agent uses a robust algorithm to solve equations:</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                                    <div class="bg-white p-3 rounded border border-blue-100">
                                        <h5 class="font-medium text-blue-700 mb-1">Step 1: Parse Equation</h5>
                                        <p class="text-sm text-gray-600">Split equation into left and right sides</p>
                                    </div>
                                    <div class="bg-white p-3 rounded border border-blue-100">
                                        <h5 class="font-medium text-blue-700 mb-1">Step 2: Simplify</h5>
                                        <p class="text-sm text-gray-600">Combine like terms on both sides</p>
                                    </div>
                                    <div class="bg-white p-3 rounded border border-blue-100">
                                        <h5 class="font-medium text-blue-700 mb-1">Step 3: Isolate Variable</h5>
                                        <p class="text-sm text-gray-600">Use inverse operations to isolate x</p>
                                    </div>
                                    <div class="bg-white p-3 rounded border border-blue-100">
                                        <h5 class="font-medium text-blue-700 mb-1">Step 4: Verify Solution</h5>
                                        <p class="text-sm text-gray-600">Plug solution back into original equation</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">Gemini API Integration</h4>
                            <ul class="list-disc pl-5 space-y-1 text-gray-600">
                                <li>Natural language processing for query understanding</li>
                                <li>Response generation for complex explanations</li>
                                <li>Secure API key management with environment variables</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-gray-900 mt-8 mb-4">Deployment</h3>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px] bg-indigo-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-vercel text-black text-xl mr-2"></i>
                                <h4 class="font-medium">Vercel</h4>
                            </div>
                            <p class="text-sm text-gray-600">Serverless platform for instant deployment</p>
                        </div>
                        <div class="flex-1 min-w-[200px] bg-gray-100 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-github text-gray-800 text-xl mr-2"></i>
                                <h4 class="font-medium">GitHub</h4>
                            </div>
                            <p class="text-sm text-gray-600">Version control and repository hosting</p>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <a href="#" class="inline-flex items-center text-indigo-600 hover:text-indigo-800">
                            <i class="fab fa-github mr-2"></i>
                            View on GitHub
                        </a>
                        <a href="#" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 ml-6">
                            <i class="fas fa-external-link-alt mr-2"></i>
                            Live Deployment
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="md:flex md:items-center md:justify-between">
                <div class="flex justify-center md:justify-start">
                    <div class="flex items-center">
                        <i class="fas fa-robot text-indigo-400 text-2xl"></i>
                        <span class="ml-2 text-xl font-bold">TutorBot Pro</span>
                    </div>
                </div>
                <div class="mt-8 md:mt-0 md:order-1">
                    <p class="text-center text-base text-gray-400">
                        Multi-Agent Tutoring System - Final Assignment
                    </p>
                </div>
            </div>
            <div class="mt-8 flex justify-center space-x-6">
                <a href="#" class="text-gray-400 hover:text-white">
                    <i class="fab fa-github"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-white">
                    <i class="fas fa-book"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-white">
                    <i class="fas fa-info-circle"></i>
                </a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const exampleBtns = document.querySelectorAll('.example-btn');
            
            // Scroll to bottom of chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Send message function
            function sendMessage() {
                const message = userInput.value.trim();
                if (!message) return;
                
                // Add user message to chat
                addMessageToChat(message, 'user');
                userInput.value = '';
                
                // Process query with Tutor Agent
                processQuery(message);
            }
            
            // Add message to chat UI
            function addMessageToChat(message, sender, toolUsed = null, constantUsed = null) {
                const messageDiv = document.createElement('div');
                
                if (sender === 'user') {
                    messageDiv.className = 'user-message p-4';
                    messageDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2">
                                <i class="fas fa-user text-blue-500"></i>
                            </div>
                            <span class="font-medium">You</span>
                        </div>
                        <p>${message}</p>
                    `;
                } 
                else if (sender === 'tutor') {
                    messageDiv.className = 'agent-message p-4 tutor-agent';
                    messageDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-2">
                                <i class="fas fa-robot text-green-500"></i>
                            </div>
                            <span class="font-medium">Tutor Agent</span>
                            <span class="tutor-tag subject-tag ml-2">Tutor</span>
                        </div>
                        <p>${message}</p>
                    `;
                }
                else if (sender === 'math') {
                    messageDiv.className = 'agent-message p-4 math-agent';
                    messageDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2">
                                <i class="fas fa-calculator text-blue-500"></i>
                            </div>
                            <span class="font-medium">Math Agent</span>
                            <span class="math-tag subject-tag ml-2">Math</span>
                            ${toolUsed ? `<span class="tool-indicator ml-2">
                                <i class="fas fa-calculator text-xs mr-1"></i>${toolUsed}
                            </span>` : ''}
                        </div>
                        ${message}
                    `;
                }
                else if (sender === 'physics') {
                    messageDiv.className = 'agent-message p-4 physics-agent';
                    messageDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-2">
                                <i class="fas fa-atom text-purple-500"></i>
                            </div>
                            <span class="font-medium">Physics Agent</span>
                            <span class="physics-tag subject-tag ml-2">Physics</span>
                            ${toolUsed ? `<span class="tool-indicator ml-2">
                                <i class="fas fa-toolbox text-xs mr-1"></i>${toolUsed}
                            </span>` : ''}
                        </div>
                        <p>${message}</p>
                        ${constantUsed ? `<div class="mt-2 text-sm bg-purple-50 p-2 rounded">${constantUsed}</div>` : ''}
                    `;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Process query with Tutor Agent
            function processQuery(query) {
                // Show typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'agent-message p-4';
                typingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span class="ml-2 text-gray-500">Tutor Agent is analyzing your question...</span>
                    </div>
                `;
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate processing time
                setTimeout(() => {
                    // Remove typing indicator
                    chatMessages.removeChild(typingDiv);
                    
                    // Classify the subject
                    const subject = classifySubject(query);
                    
                    // Route to appropriate agent
                    if (subject === 'math') {
                        routeToMathAgent(query);
                    } else if (subject === 'physics') {
                        routeToPhysicsAgent(query);
                    } else {
                        // General response from Tutor Agent
                        addMessageToChat("I'm not sure which specialist can best help with that. I'll try my best!", 'tutor');
                        // Default to math if unsure
                        setTimeout(() => routeToMathAgent(query), 1000);
                    }
                }, 1500);
            }
            
            // Classify the subject of the query
            function classifySubject(query) {
                const lowerQuery = query.toLowerCase();
                
                // Check for math-related keywords
                const mathKeywords = ['math', 'algebra', 'geometry', 'calculus', 'equation', 'solve', 'calculate', 'formula', 'x=', 'y=', 'number', 'integral', 'derivative'];
                if (mathKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    return 'math';
                }
                
                // Check for physics-related keywords
                const physicsKeywords = ['physics', 'newton', 'quantum', 'entanglement', 'law', 'thermodynamics', 'force', 'velocity', 'acceleration', 'energy', 'particle'];
                if (physicsKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    return 'physics';
                }
                
                // Check for equations or calculations
                if (/\d+[\+\-\*\/]\d+/.test(lowerQuery) || /solve for [a-z]/.test(lowerQuery) || lowerQuery.includes('=')) {
                    return 'math';
                }
                
                // Check for physics concepts
                if (lowerQuery.includes('law of') || lowerQuery.includes('constant')) {
                    return 'physics';
                }
                
                return 'unknown';
            }
            
            // Route to Math Agent
            function routeToMathAgent(query) {
                // Show routing message
                addMessageToChat(`I see this is a math question. Routing to Math Agent...`, 'tutor');
                
                // Show typing indicator for Math Agent
                const mathTypingDiv = document.createElement('div');
                mathTypingDiv.className = 'agent-message p-4';
                mathTypingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span class="ml-2 text-gray-500">Math Agent is processing your question...</span>
                    </div>
                `;
                chatMessages.appendChild(mathTypingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate processing time
                setTimeout(() => {
                    // Remove typing indicator
                    chatMessages.removeChild(mathTypingDiv);
                    
                    // Process with Math Agent
                    const [response, toolUsed, calculation] = mathAgentResponse(query);
                    addMessageToChat(response, 'math', toolUsed, calculation);
                }, 2000);
            }
            
            // Math Agent response logic
            function mathAgentResponse(query) {
                const lowerQuery = query.toLowerCase();
                let response = '';
                let toolUsed = null;
                let calculation = null;
                
                // Equation solving
                if (lowerQuery.includes('solve') || lowerQuery.includes('=')) {
                    toolUsed = 'Equation Solver';
                    
                    let equation = query;
                    if (lowerQuery.includes('solve')) {
                        const parts = query.split(/solve/i);
                        if(parts.length > 1 && parts[1]) {
                           equation = parts[1].trim();
                        }
                    }
                    
                    response = solveEquation(equation);
                } 
                // Area calculation
                else if (lowerQuery.includes('area')) {
                    toolUsed = 'Calculator';
                    
                    if (lowerQuery.includes('circle')) {
                        const radiusMatch = query.match(/\d+/);
                        const radius = radiusMatch ? parseInt(radiusMatch[0]) : 1;
                        const area = (Math.PI * radius * radius).toFixed(2);
                        response = `The area of a circle with radius ${radius} is calculated as π × r² = ${area}`;
                        calculation = `Calculation: π × ${radius}² ≈ 3.1416 × ${radius*radius} = ${area}`;
                    } else if (lowerQuery.includes('rectangle')) {
                        const dims = query.match(/\d+/g);
                        if (dims && dims.length >= 2) {
                            const area = parseInt(dims[0]) * parseInt(dims[1]);
                            response = `The area of a rectangle ${dims[0]}×${dims[1]} is ${area}`;
                            calculation = `Calculation: ${dims[0]} × ${dims[1]} = ${area}`;
                        } else {
                            response = `Please provide dimensions for the rectangle.`;
                        }
                    } else {
                        response = `I can help with area calculations for circles, rectangles, and triangles.`;
                    }
                } 
                // Pythagorean theorem
                else if (lowerQuery.includes('pythagorean')) {
                    response = `The Pythagorean theorem states that in a right-angled triangle, the square of the hypotenuse is equal to the sum of the squares of the other two sides: a² + b² = c²`;
                } 
                // Default math response
                else {
                    response = `Math Agent: I've processed your math question about "${query}". My capabilities are focused on equation solving and basic calculations. Please try asking me to "solve" an equation.`;
                }
                
                return [response, toolUsed, calculation];
            }
            
            // Equation solver with step-by-step solution
            function solveEquation(equationStr) {
                if (typeof equationStr !== 'string' || !equationStr.trim()) {
                    return "Math Agent: Please provide an equation to solve (e.g., 'solve 3x - 7 = 14').";
                }
                
                let equation = equationStr.toLowerCase().replace('solve', '').trim();
                
                if (!equation.includes('=')) {
                    return "Math Agent: Please provide a valid equation with an equals sign (e.g., 3x - 7 = 14).";
                }
                
                let [leftSide, rightSide] = equation.split('=').map(side => side.trim());
                
                try {
                    const steps = [];
                    const originalEquationForDisplay = `${leftSide} = ${rightSide}`;
                    steps.push({
                        description: `Start with the original equation:`,
                        equation: originalEquationForDisplay
                    });

                    // Handle parentheses distribution e.g., 2(x + 3)
                    if (leftSide.includes('(')) {
                        const match = leftSide.match(/(-?\d*\.?\d*)\s*\((.+)\)/);
                        if (match) {
                            const multiplier = (match[1] === '' || match[1] === '+') ? 1 : (match[1] === '-') ? -1 : parseFloat(match[1]);
                            const insideExpr = match[2];

                            // Parse inside expression (e.g., 'x + 3')
                            const insideXMatch = insideExpr.match(/(-?\d*\.?\d*)x/);
                            let insideCoeff = insideExpr.includes('x') ? (insideXMatch ? ((insideXMatch[1] === '' || insideXMatch[1] === '+') ? 1 : (insideXMatch[1] === '-') ? -1 : parseFloat(insideXMatch[1])) : 1) : 0;
                            const insideConstString = insideExpr.replace(insideXMatch ? insideXMatch[0] : 'x', '').trim();
                            let insideConst = insideConstString ? parseFloat(insideConstString.replace(/\s/g, '')) : 0;
                            
                            const newCoeff = multiplier * insideCoeff;
                            const newConst = multiplier * insideConst;
                            
                            const expandedLeftSide = `${newCoeff}x ${newConst >= 0 ? '+' : '-'} ${Math.abs(newConst)}`;
                            
                            steps.push({
                                description: `Distribute the ${multiplier} into the parentheses:`,
                                equation: `${leftSide}  →  ${expandedLeftSide}`
                            });

                            leftSide = expandedLeftSide.replace(/\s/g, ''); // Update leftSide for further processing
                        }
                    }

                    // Parse the left side for coefficient and constant
                    let coefficient = 0;
                    let constant = 0;
                    // Regex to find all terms (e.g., '2x', '-7', '+x')
                    const terms = leftSide.replace(/\s/g, '').match(/([+\-]?\d*\.?\d*x|[+\-]?\d+\.?\d*)/g) || [];
                    
                    terms.forEach(term => {
                        if (term.includes('x')) {
                            if (term === 'x' || term === '+x') coefficient += 1;
                            else if (term === '-x') coefficient -= 1;
                            else coefficient += parseFloat(term.replace('x', ''));
                        } else if (term) {
                            constant += parseFloat(term);
                        }
                    });

                    const rightValue = parseFloat(rightSide);
                    
                    if (isNaN(rightValue) || (coefficient === 0 && !leftSide.includes('x'))) {
                       return `Math Agent: I was unable to parse the equation "${equationStr}". I can solve simple linear equations like '3x - 7 = 14'.`;
                    }
                    if (coefficient === 0) {
                        return (rightValue - constant === 0) ?
                            "Math Agent: This is an identity (e.g., 5 = 5), so there are infinite solutions." :
                            "Math Agent: This is a contradiction (e.g., 5 = 10), so there is no solution.";
                    }

                    const newRight = rightValue - constant;
                    if (constant !== 0) {
                        steps.push({
                            description: `Isolate the variable term by moving the constant (${constant > 0 ? '+' : ''}${constant}) to the other side:`,
                            equation: `${coefficient}x = ${rightValue} ${constant >= 0 ? '-' : '+'} ${Math.abs(constant)}`
                        });
                        steps.push({
                            description: `Simplify the right side:`,
                            equation: `${coefficient}x = ${newRight}`
                        });
                    }
                    
                    const solution = newRight / coefficient;
                    if (coefficient !== 1) {
                         steps.push({
                            description: `Solve for x by dividing both sides by ${coefficient}:`,
                            equation: `x = ${newRight} / ${coefficient}`
                        });
                    }
                   
                    steps.push({
                        description: `Final Solution:`,
                        equation: `x = ${solution}`
                    });

                    let solutionHTML = `<p class="text-lg font-medium mb-3">Solving: <span class="equation">${equationStr}</span></p>`;
                    
                    // Filter out the "start" step if distribution happened
                    const stepsToDisplay = steps.filter((step, index) => !(index === 0 && steps.length > 1 && steps[1].description.includes('Distribute')));
                    stepsToDisplay.forEach((step, index) => {
                        solutionHTML += `
                        <div class="math-step">
                            <p class="font-medium text-sm text-gray-700">Step ${index + 1}: ${step.description}</p>
                            <p class="equation my-2">${step.equation}</p>
                        </div>`;
                    });

                    // Verification
                    const verificationLHS = (coefficient * solution + constant);
                    solutionHTML += `
                    <div class="solution">
                        <p class="font-semibold">Solution: <span class="equation">x = ${solution}</span></p>
                        <p class="mt-2 text-sm">Verification (plugging into original simplified left side):</p>
                        <p class="equation mt-1">${coefficient}(${solution}) ${constant >= 0 ? '+' : '-'} ${Math.abs(constant)} = ${rightValue}</p>
                        <p class="equation mt-1">${verificationLHS.toFixed(5)} = ${rightValue.toFixed(5)}</p>
                        ${Math.abs(verificationLHS - rightValue) < 1e-9 ? 
                            '<p class="mt-2 text-green-600 font-medium">Both sides are equal! Solution is correct.</p>' :
                            '<p class="mt-2 text-red-600 font-medium">Verification failed. Please check calculation.</p>'}
                    </div>`;

                    return solutionHTML;
                } catch (e) {
                     console.error("Error solving equation:", e);
                    return `<p>Math Agent: I encountered an error solving this equation. My solver is still learning! Please try a simple linear equation.</p>`;
                }
            }
            
            // Route to Physics Agent
            function routeToPhysicsAgent(query) {
                // Show routing message
                addMessageToChat(`I see this is a physics question. Routing to Physics Agent...`, 'tutor');
                
                // Show typing indicator for Physics Agent
                const physicsTypingDiv = document.createElement('div');
                physicsTypingDiv.className = 'agent-message p-4';
                physicsTypingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span class="ml-2 text-gray-500">Physics Agent is processing your question...</span>
                    </div>
                `;
                chatMessages.appendChild(physicsTypingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate processing time
                setTimeout(() => {
                    // Remove typing indicator
                    chatMessages.removeChild(physicsTypingDiv);
                    
                    // Process with Physics Agent
                    const [response, toolUsed, constantUsed] = physicsAgentResponse(query);
                    addMessageToChat(response, 'physics', toolUsed, constantUsed);
                }, 2000);
            }
            
            // Physics Agent response logic
            function physicsAgentResponse(query) {
                const lowerQuery = query.toLowerCase();
                let response = '';
                let toolUsed = null;
                let constantUsed = null;
                
                // Constants database
                const constants = {
                    'gravitational constant': 'G = 6.67430 × 10⁻¹¹ m³ kg⁻¹ s⁻²',
                    'speed of light': 'c = 299,792,458 m/s',
                    'planck constant': 'h = 6.62607015 × 10⁻³⁴ J·s',
                };
                
                // Newton's laws
                if (lowerQuery.includes('newton') && (lowerQuery.includes('second law') || lowerQuery.includes('2nd law'))) {
                    response = `Newton's second law states that the acceleration of an object is directly proportional to the net force acting on it and inversely proportional to its mass. The formula is F = m × a, where F is force, m is mass, and a is acceleration.`;
                    constantUsed = `Formula: F = m × a`;
                } 
                else if (lowerQuery.includes('newton') && (lowerQuery.includes('third law') || lowerQuery.includes('3rd law'))) {
                    response = `Newton's third law states that for every action, there is an equal and opposite reaction.`;
                } 
                // Quantum entanglement
                else if (lowerQuery.includes('quantum') && lowerQuery.includes('entanglement')) {
                    response = `Quantum entanglement is a phenomenon where two particles are linked in such a way that their fates are intertwined, no matter how far apart they are. Measuring a property of one particle instantly influences the other.`;
                } 
                // Constants lookup
                else if (lowerQuery.includes('constant')) {
                    toolUsed = 'Constants Lookup';
                    
                    const constantKey = Object.keys(constants).find(key => 
                        lowerQuery.includes(key)
                    );
                    
                    if (constantKey) {
                        response = `The ${constantKey} is: ${constants[constantKey]}`;
                        constantUsed = `Constant value: ${constants[constantKey]}`;
                    } else {
                        response = `I have information on these constants: ${Object.keys(constants).join(', ')}. Which one are you interested in?`;
                    }
                } 
                // Thermodynamics
                else if (lowerQuery.includes('thermodynamics')) {
                    response = `The laws of thermodynamics describe the relationships between heat, work, and energy. The first law is about energy conservation, the second about entropy (disorder), and the third about absolute zero temperature.`;
                } 
                // Default physics response
                else {
                    response = `Physics Agent: I've processed your physics question about "${query}". Please ask about a specific law, concept, or constant for a detailed explanation.`;
                }
                
                return [response, toolUsed, constantUsed];
            }
            
            // Event listeners
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            exampleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    userInput.value = this.dataset.query;
                    sendMessage();
                });
            });
        });
    </script>
</body>
</html>
